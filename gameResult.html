<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game - Result</title>

  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Mind - Match</h1>
    <h2></h2>
    <p class="text"></p>
    <p class="score"></p>
    <div class="table-container">
      <table>
        <tr>
            <th>Player Name</th>
            <th>Cards Number</th>
            <th>Success</th>
        </tr>
      </table>
    </div>
    <button style="margin: 15px;" onclick="playAgain();">Play Again</button>
  </div>
  <script>
    // Retrieve data from local storage
    const dataString = localStorage.getItem('gameHistory');
    const names = localStorage.getItem('playersName');
  
    // Parse JSON string back to object
    const historyData = JSON.parse(dataString);
    const namesData = JSON.parse(names);

    let score1 = 0;
    let score2 = 0;
    historyData.forEach(element => {
      if (element.success) {
        if (element.player === 'one') {
          score1++;
        } else {
          score2++;
        }
      }
    });
    if (score1 > score2) {
        document.querySelector('h2').innerHTML = `Winner is ${namesData[0]}`;
        document.querySelector('.score').innerHTML = `${score1}`;
    } else {
        document.querySelector('h2').innerHTML = `Winner is ${namesData[1]}`;
        document.querySelector('.score').innerHTML = `${score2}`;
    }
    document.querySelector('.text').innerHTML = `Number of correct cards`;

    let isPlayer1 = true;
    historyData.forEach(elemet => {
      if(isPlayer1){
        const row = createRow(namesData[0], elemet.card1, elemet.card2, elemet.success);
        document.querySelector('table').appendChild(row);
        isPlayer1 = false;
      }else{
        const row = createRow(namesData[1], elemet.card1, elemet.card2, elemet.success);
        document.querySelector('table').appendChild(row);
        isPlayer1 = true;
      }
    });

    function createRow(name, card1, card2, isSuccess){
      const tr = document.createElement('tr');
      const td1 = document.createElement('td');
      td1.innerHTML = name;
      const td2 = document.createElement('td');
      td2.innerHTML = `Open card ${card1} and ${card2}`;
      const td3 = document.createElement('td');
      td3.innerHTML = isSuccess;

      tr.append(td1);
      tr.append(td2);
      tr.append(td3);

      return tr;
    }

    function playAgain(){
      localStorage.clear();
      window.location.href = 'home.html';
    }
  </script>
</body>
</html>